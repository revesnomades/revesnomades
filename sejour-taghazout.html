<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Voyage à Taghazout — Rêves Nomades</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=MuseoModerno:wght@400;500;600&family=Be+Vietnam+Pro:wght@200;300;400;500&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body class="on-light">

  <!-- NAV -->
  <header class="nav" id="top">
    <div class="container nav-inner">
      <a class="brand" href="index.html" aria-label="Accueil Rêves Nomades">
        <img src="assets/img/logo-reves-nomades.png" alt="Logo Rêves Nomades" />
        <span>Rêves Nomades</span>
      </a>

      <nav class="nav-links nav-links-desktop">
        <a href="index.html#apropos" data-scroll>À propos</a>
        <a href="index.html#contact" data-scroll>Contact</a>
        <a class="icon-btn" href="compte.html" aria-label="Compte">
          <svg class="icon" viewBox="0 0 24 24" fill="none">
            <path d="M20 21c0-4.418-3.582-8-8-8s-8 3.582-8 8" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
            <path d="M12 13a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9Z" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
        </a>
      </nav>

      <button class="hamburger" type="button" aria-label="Ouvrir le menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>

      <div class="mobile-drawer" aria-hidden="true">
        <div class="mobile-menu">
          <a href="index.html#apropos" data-scroll>À propos</a>
          <a href="index.html#contact" data-scroll>Contact</a>
          <a href="compte.html">Compte</a>
        </div>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="sejour-hero">
    <div class="sejour-hero-bg" style="background-image:url('assets/img/sejour-taghazout.jpg');"></div>
  </section>

  <!-- CONTENT -->
  <section class="band cream">
    <div class="container sejour-content">

      <h1 class="reveal">Voyage à Taghazout</h1>

      <p class="sejour-meta reveal">
        5 jours · 4 nuits — <strong>780 €</strong> / personne
      </p>

      <p class="sejour-dates reveal">
        Dates : <span id="stayDates">Dates à annoncer</span>
      </p>

      <div class="sejour-text reveal">
        <p>
          Une immersion entre océan et lumière. Taghazout invite à ralentir : respirer,
          se remettre en mouvement, renouer avec une énergie plus simple.
        </p>

        <h3 style="margin-top:22px;">Ce qui vous attend</h3>
        <p>
          Pilates quotidien, rituels matin/soir, activités locales (découverte, nature),
          cuisine saine préparée par une cheffe, et un atelier cuisine pour repartir avec des habitudes faciles à intégrer.
        </p>

        <h3 style="margin-top:22px;">Programme type (exemple)</h3>
        <p><b>Jour 1 —</b> Accueil · coucher de soleil · cercle d’ouverture · Pilates doux.</p>
        <p><b>Jour 2 —</b> Pilates · respiration · activité locale · temps libre · dîner sain.</p>
        <p><b>Jour 3 —</b> Pilates · randonnée / découverte · atelier cuisine avec cheffe.</p>
        <p><b>Jour 4 —</b> Pilates · temps pour soi · massage en supplément · rituel de clôture.</p>
        <p><b>Jour 5 —</b> Pilates doux · cercle de départ · retour rechargé(e).</p>

        <h3 style="margin-top:22px;">Massages (option)</h3>
        <p>
          Possibilité de réserver un massage en supplément sur place (selon disponibilités).
        </p>

        <!-- SAC CADEAU -->
        <section class="reveal gift-pack">
          <div class="gift-pack-grid">
            <div class="gift-pack-text">
              <h3>Le sac cadeau Rêves Nomades</h3>
              <p class="sub" style="margin-top:10px;">
                À votre arrivée, vous recevez un sac cadeau imaginé pour prolonger l’expérience.
              </p>
              <ul class="gift-pack-list">
                <li>Tee-shirt Rêves Nomades</li>
                <li>Sac en tissu</li>
                <li>Gourde réutilisable</li>
                <li>Carnet & stylo</li>
                <li>Un soin bien-être (surprise)</li>
              </ul>
            </div>
            <div class="gift-pack-image">
              <img src="assets/img/sac-cadeau-reves-nomades.jpg" alt="Sac cadeau Rêves Nomades">
            </div>
          </div>
        </section>
      </div>

      <p class="sejour-count reveal">
        Encore <strong id="missingCount">—</strong> réservations nécessaires pour valider ce séjour.
        <br>
        <span class="hint">Un email de confirmation vous sera envoyé dès que le séjour sera validé.</span>
      </p>

      <!-- BOOKING -->
      <div class="booking-box reveal">
        <h3>Réserver</h3>

        <label class="kicker" for="roomSelect">Type de chambre</label>
        <select id="roomSelect" style="
          width:min(520px, 100%);
          margin-top:8px;
          padding:12px;
          border-radius:0;
          border:1px solid rgba(30,31,34,.18);
          background: rgba(255,255,255,.85);
          font-family:inherit;
          font-weight:300;
          color: var(--text);
        ">
          <option value="shared">Chambre partagée (incluse)</option>
          <option value="single">Chambre individuelle (+120€)</option>
        </select>

        <p class="small muted" style="margin-top:10px;">
          La quantité se sélectionne directement sur Stripe.
        </p>

        <div class="price-line">
          <span>Prix</span>
          <strong id="stayPriceLive">—</strong>
        </div>

        <div class="actions" style="margin-top:16px;">
          <a id="payBtn" class="btn on-light" target="_blank" rel="noopener">Réserver sur Stripe</a>
        </div>

        <p id="bookingMsg" class="small muted" style="margin-top:10px;"></p>
      </div>

      <script>
        const BASE_PRICE = 780;
        const SINGLE_EXTRA = 120;

        const STRIPE_LINKS = {
          shared: "https://buy.stripe.com/test_3cI5kx3CFgME4Fv1oM0ZW01",
          single: "https://buy.stripe.com/test_aFabIVc9b2VO6ND0kI0ZW08"
        };

        const sel = document.getElementById("roomSelect");
        const btn = document.getElementById("payBtn");
        const msg = document.getElementById("bookingMsg");
        const priceEl = document.getElementById("stayPriceLive");

        function formatEUR(n){
          return new Intl.NumberFormat("fr-FR", { style:"currency", currency:"EUR" }).format(n);
        }

        function syncBooking(){
          const room = sel.value;
          const link = STRIPE_LINKS[room];
          const price = room === "single" ? (BASE_PRICE + SINGLE_EXTRA) : BASE_PRICE;
          priceEl.textContent = formatEUR(price);

          if(!link){
            btn.removeAttribute("href");
            msg.textContent = "Lien Stripe manquant pour ce type de chambre.";
            return;
          }
          btn.href = link;
          msg.textContent = "";
        }

        sel.addEventListener("change", syncBooking);
        syncBooking();
      </script>

    </div>
  </section>

  <footer class="band cream">
    <div class="container footer">
      <div class="legal">
        <div style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;">
          <div>Copyright © 2026 Rêves Nomades</div>
          <div>
            <a href="mentions-legales.html">Mentions légales</a> ·
            <a href="politique-confidentialite.html">Politique de confidentialité</a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script src="assets/js/main.js"></script>

  <script type="module">
    import { hydrateStayPageDate } from "./assets/js/stayDates.js";
    hydrateStayPageDate("taghazout", "stayDates");
  </script>

  <script type="module">
    import { supabase } from "./assets/js/supabaseClient.js";
    const EVENT_ID = "9617c1f3-269c-475f-9bb3-38ede5ebdd1e";
    const MIN_BOOKINGS = 10;

    async function loadMissing(){
      const el = document.getElementById("missingCount");
      if(!el) return;

      const { data, error } = await supabase
        .from("bookings")
        .select("places")
        .eq("event_id", EVENT_ID)
        .eq("paid", true);

      if(error){ el.textContent = "—"; return; }

      const total = (data || []).reduce((sum, b) => sum + (Number(b.places) || 0), 0);
      el.textContent = String(Math.max(0, MIN_BOOKINGS - total));
    }
    loadMissing();
  </script>

</body>
</html>
