<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Voyage à Taghazout — Rêves Nomades</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=MuseoModerno:wght@400;500;600&family=Be+Vietnam+Pro:wght@200;300;400;500&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body class="on-light">

  <!-- NAV -->
  <header class="nav" id="top">
    <div class="container nav-inner">
      <a class="brand" href="index.html" aria-label="Accueil Rêves Nomades">
        <img src="assets/img/logo-reves-nomades.png" alt="Logo Rêves Nomades" />
        <span>Rêves Nomades</span>
      </a>

      <nav class="nav-links nav-links-desktop">
        <a href="index.html#apropos" data-scroll>À propos</a>
        <a href="index.html#contact" data-scroll>Contact</a>
        <a class="icon-btn" href="compte.html" aria-label="Compte">
          <svg class="icon" viewBox="0 0 24 24" fill="none">
            <path d="M20 21c0-4.418-3.582-8-8-8s-8 3.582-8 8" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
            <path d="M12 13a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9Z" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
        </a>
      </nav>

      <!-- Hamburger -->
      <button class="hamburger" type="button" aria-label="Ouvrir le menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>

      <!-- Drawer mobile -->
      <div class="mobile-drawer" aria-hidden="true">
        <div class="mobile-menu">
          <a href="index.html#apropos" data-scroll>À propos</a>
          <a href="index.html#contact" data-scroll>Contact</a>
          <a href="compte.html">Compte</a>
        </div>
      </div>
    </div>
  </header>

  <!-- HERO IMAGE -->
  <section class="sejour-hero">
    <div class="sejour-hero-bg" style="background-image:url('assets/img/sejour-taghazout.jpg');"></div>
  </section>

  <!-- CONTENT -->
  <section class="band cream">
    <div class="container sejour-content">

      <h1 class="reveal">Voyage à Taghazout</h1>

      <p class="sejour-meta reveal">
        5 jours · 4 nuits — <strong>780 €</strong> / personne
      </p>

      <p class="sejour-dates reveal">
        Dates : <span id="stayDates">Chargement…</span>
      </p>

      <div class="sejour-text reveal">
        <p>
          Une immersion entre océan et lumière, pour se déposer, respirer et se remettre en mouvement en douceur.
        </p>
        <p>
          Pilates quotidien, activités liées au lieu, massages, cuisine saine par une cheffe,
          et ateliers cuisine pour apprendre à cuisiner bon et sain.
        </p>
        <p>
          Un séjour pour vivre avec intensité, sans se presser. L’essentiel, ici et maintenant.
        </p>
      </div>

      <!-- DÉCOMPTE (une seule fois) -->
      <p class="sejour-count reveal">
        Encore <strong id="missingCount">—</strong> réservations nécessaires pour valider ce séjour.
        <br>
        <span class="hint">Un email de confirmation vous sera envoyé dès que le séjour sera validé.</span>
      </p>

      <!-- Réservation -->
      <div class="booking-box reveal">
        <h3>Réserver</h3>

        <label class="kicker" for="roomSelect">Type de chambre</label>
        <select id="roomSelect" style="
          width:min(520px, 100%);
          margin-top:8px;
          padding:12px;
          border-radius:0;
          border:1px solid rgba(30,31,34,.18);
          background: rgba(255,255,255,.85);
          font-family:inherit;
          font-weight:300;
          color: var(--text);
        ">
          <option value="shared">Chambre partagée (incluse)</option>
          <option value="single">Chambre individuelle (+120€)</option>
        </select>

        <p class="small muted" style="margin-top:10px;">
          La quantité se sélectionne directement sur Stripe.
        </p>
        <div class="price-line">
  <span>Prix</span>
  <strong id="stayPriceLive">—</strong>
</div>

        <div class="actions" style="margin-top:16px;">
          <a id="payBtn" class="btn on-light" target="_blank" rel="noopener">
            Réserver sur Stripe
          </a>
        </div>

        <p id="bookingMsg" class="small muted" style="margin-top:10px;"></p>
      </div>

    </div>
  </section>

  <!-- FOOTER -->
  <footer class="band cream">
    <div class="container footer">

      <div class="footer-row">
        <div class="footer-brand reveal" data-delay="0">
          <img src="assets/img/logo-reves-nomades.png" alt="Rêves Nomades">
          <div style="font-family:MuseoModerno; font-weight:500;">Rêves Nomades</div>
        </div>

        <div class="footer-social reveal" data-delay="1">
          <a class="icon-btn light" href="https://instagram.com/TON_COMPTE" target="_blank" rel="noopener" aria-label="Instagram">
            <svg class="icon" viewBox="0 0 24 24" fill="none">
              <path d="M7.5 2h9A5.5 5.5 0 0 1 22 7.5v9A5.5 5.5 0 0 1 16.5 22h-9A5.5 5.5 0 0 1 2 16.5v-9A5.5 5.5 0 0 1 7.5 2Z" stroke="currentColor" stroke-width="1.7"/>
              <path d="M12 16.2A4.2 4.2 0 1 0 12 7.8a4.2 4.2 0 0 0 0 8.4Z" stroke="currentColor" stroke-width="1.7"/>
              <path d="M17.6 6.4h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            </svg>
          </a>

          <a class="icon-btn light" href="https://facebook.com/TA_PAGE" target="_blank" rel="noopener" aria-label="Facebook">
            <svg class="icon" viewBox="0 0 24 24" fill="none">
              <path d="M14 9h3V6h-3c-2.2 0-4 1.8-4 4v3H7v3h3v6h3v-6h3l1-3h-4v-3c0-.6.4-1 1-1Z" fill="currentColor"/>
            </svg>
          </a>

          <a href="index.html#apropos" style="font-size:12px; letter-spacing:.08em; text-transform:uppercase;">À propos</a>
        </div>
      </div>

      <div class="legal reveal" data-delay="2">
        <div style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;">
          <div>Copyright © 2026 Rêves Nomades</div>
          <div>
            <a href="mentions-legales.html">Mentions légales</a> ·
            <a href="politique-confidentialite.html">Politique de confidentialité</a>
          </div>
        </div>
      </div>

    </div>
  </footer>

  <script src="assets/js/main.js"></script>
<script type="module">
  import { hydrateStayPageDate } from "./assets/js/stayDates.js";
  hydrateStayPageDate("taghazout", "stayDates");
</script>

  <!-- Stripe link switch (Taghazout) -->
  <script>
  // Prix base et supplément
  const BASE_PRICE = 780;
  const SINGLE_EXTRA = 120;

  // Stripe links
  const STRIPE_LINKS = {
    shared: "https://buy.stripe.com/test_3cI5kx3CFgME4Fv1oM0ZW01",
    single: "https://buy.stripe.com/test_9B6cMZ6ORgME3Breby0ZW0a"
  };

  const sel = document.getElementById("roomSelect");
  const btn = document.getElementById("payBtn");
  const msg = document.getElementById("bookingMsg");
  const priceEl = document.getElementById("stayPriceLive");

  function formatEUR(n){
    return new Intl.NumberFormat("fr-FR", { style:"currency", currency:"EUR" }).format(n);
  }

  function syncBooking(){
    const room = sel.value;
    const link = STRIPE_LINKS[room];

    // Prix affiché
    const price = room === "single" ? (BASE_PRICE + SINGLE_EXTRA) : BASE_PRICE;
    priceEl.textContent = formatEUR(price);

    // Lien Stripe
    if(!link){
      btn.removeAttribute("href");
      msg.textContent = "Lien Stripe manquant pour ce type de chambre.";
      return;
    }
    btn.href = link;
    msg.textContent = "";
  }

  sel.addEventListener("change", syncBooking);
  syncBooking();
</script>


  <!-- Supabase: dates + missing count (Taghazout) -->
  <script type="module">
    import { supabase } from "./assets/js/supabaseClient.js";

    const EVENT_ID = "9617c1f3-269c-475f-9bb3-38ede5ebdd1e";
    const MIN_BOOKINGS = 10;

    function fmt(d){
      const [y,m,day] = String(d).split("-");
      return `${day}/${m}/${y}`;
    }

    async function loadEventData(){
      const dateEl = document.getElementById("stayDates");
      const missingEl = document.getElementById("missingCount");

      // ---- dates ----
      const { data: event, error: eventErr } = await supabase
        .from("events")
        .select("start_date, end_date, place")
        .eq("id", EVENT_ID)
        .single();

      if(eventErr || !event){
        dateEl.textContent = "Dates à annoncer";
      } else {
        dateEl.textContent =
          `du ${fmt(event.start_date)} au ${fmt(event.end_date)}`;
      }

      // ---- missing count ----
      const { data: bookings, error: bookErr } = await supabase
        .from("bookings")
        .select("places")
        .eq("event_id", EVENT_ID)
        .eq("paid", true);

      if(bookErr){
        missingEl.textContent = "—";
        return;
      }

      const total = (bookings || []).reduce(
        (sum, b) => sum + (Number(b.places) || 0),
        0
      );

      missingEl.textContent = String(Math.max(0, MIN_BOOKINGS - total));
    }

    loadEventData();
  </script>

</body>
</html>
