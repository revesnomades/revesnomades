<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Compte — Rêves Nomades</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">
  <link rel="manifest" href="/assets/img/site.webmanifest">
  <link rel="icon" href="/assets/img/favicon.ico">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;500;600&family=Be+Vietnam+Pro:wght@200;300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>

<body class="on-light">

  <!-- NAV -->
  <header class="nav">
    <div class="container nav-inner">
      <a class="brand" href="index.html">
        <img src="assets/img/logo-reves-nomades.png" alt="Rêves Nomades">
        <span>Rêves Nomades</span>
      </a>
      <div class="nav-links nav-links-desktop">
        <a href="index.html#apropos">À propos</a>
        <a href="index.html#contact">Contact</a>
      </div>
    </div>
  </header>

  <!-- PAGE -->
  <section class="band cream">
    <div class="account-section">
      <div class="container account-grid">

        <!-- COLONNE GAUCHE -->
        <div class="account-card">
          <h2>Mon compte</h2>
          <p style="color:var(--muted); margin:10px 0 0;">
            Accédez à vos réservations et suivez la validation des séjours.
          </p>

          <!-- Auth (visible si déconnecté) -->
          <div id="authBox" style="margin-top:16px;">
            <div style="display:grid; gap:10px;">
              <input id="email" class="input"
                style="color:var(--text); background:rgba(255,255,255,.55); border:1px solid var(--line);"
                placeholder="Email">

              <input id="password" class="input"
                style="color:var(--text); background:rgba(255,255,255,.55); border:1px solid var(--line);"
                type="password" placeholder="Mot de passe">

              <div class="account-actions">
                <button class="btn on-light" id="btnLogin" type="button">Connexion</button>
                <button class="btn on-light" id="btnSignup" type="button">Inscription</button>
              </div>

              <!-- Mot de passe oublié -->
              <button class="btn on-light" id="btnForgot" type="button" style="justify-content:flex-start;">
                Mot de passe oublié ?
              </button>

              <div id="authMsg" style="color:var(--muted); font-size:12.5px;"></div>
            </div>
          </div>

          <!-- Zone RESET (visible seulement si lien reçu) -->
          <div id="resetBox" style="display:none; margin-top:16px;">
            <h3 style="font-weight:500; margin:0;">Créer un nouveau mot de passe</h3>

            <div style="display:grid; gap:10px; margin-top:10px;">
              <input id="newPassword" class="input"
                style="color:var(--text); background:rgba(255,255,255,.55); border:1px solid var(--line);"
                type="password" placeholder="Nouveau mot de passe">

              <button class="btn on-light" id="btnUpdatePassword" type="button">
                Mettre à jour mon mot de passe
              </button>

              <div id="resetMsg" style="color:var(--muted); font-size:12.5px;"></div>
            </div>
          </div>

          <!-- Logged (visible si connecté) -->
          <div id="loggedBox" style="display:none; margin-top:16px;">
            <div style="color:var(--muted); font-size:13px;">
              Connecté(e) : <b id="userEmail"></b>
            </div>

            <!-- ✅ boutons visibles seulement une fois connecté -->
            <div class="account-actions" style="margin-top:12px;">
              <button class="btn on-light" id="btnSeeBookings" type="button">Voir mes réservations</button>
              <button class="btn on-light" id="btnLogout" type="button">Déconnexion</button>
            </div>

            <div id="loggedMsg" style="margin-top:10px; color:var(--muted); font-size:12.5px;"></div>
          </div>
        </div>

        <!-- COLONNE DROITE -->
        <div>
          <!-- Avantages si déconnecté -->
          <div id="perksBox" class="account-card">
            <h3 style="font-weight:500; margin:0;">Pourquoi créer un compte ?</h3>
            <p style="color:var(--muted); margin-top:10px;">
              • Suivre vos réservations passées et à venir<br>
              • Voir le nombre de réservations restantes pour valider un séjour (min. 10)<br>
              • Recevoir les informations pratiques et mises à jour
            </p>
          </div>

          <!-- Réservations si connecté -->
          <div id="bookingsBox" class="account-card" style="display:none;">
            <h3 style="font-weight:500; margin:0;">Mes réservations</h3>
            <div id="bookingsList" style="margin-top:12px; color:var(--muted);">Chargement…</div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="band cream">
    <div class="container footer">
      <div class="footer-row">
        <div class="footer-brand">
          <img src="assets/img/logo-reves-nomades.png" alt="Rêves Nomades">
          <div style="font-family:'Playfair Display'; font-weight:500;">Rêves Nomades</div>
        </div>

        <div class="footer-social">
          <a class="icon-btn light" href="https://instagram.com/TON_COMPTE" target="_blank" rel="noopener" aria-label="Instagram">
            <svg class="icon" viewBox="0 0 24 24" fill="none">
              <path d="M7.5 2h9A5.5 5.5 0 0 1 22 7.5v9A5.5 5.5 0 0 1 16.5 22h-9A5.5 5.5 0 0 1 2 16.5v-9A5.5 5.5 0 0 1 7.5 2Z" stroke="currentColor" stroke-width="1.7"/>
              <path d="M12 16.2A4.2 4.2 0 1 0 12 7.8a4.2 4.2 0 0 0 0 8.4Z" stroke="currentColor" stroke-width="1.7"/>
              <path d="M17.6 6.4h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            </svg>
          </a>

          <a class="icon-btn light" href="https://facebook.com/TA_PAGE" target="_blank" rel="noopener" aria-label="Facebook">
            <svg class="icon" viewBox="0 0 24 24" fill="none">
              <path d="M14 9h3V6h-3c-2.2 0-4 1.8-4 4v3H7v3h3v6h3v-6h3l1-3h-4v-3c0-.6.4-1 1-1Z" fill="currentColor"/>
            </svg>
          </a>

          <a href="index.html#apropos" style="font-size:12px; letter-spacing:.08em; text-transform:uppercase;">À propos</a>
        </div>
      </div>

      <div class="legal">
        <div style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;">
          <div>Copyright © 2026 Rêves Nomades</div>
          <div>
            <a href="mentions-legales.html">Mentions légales</a> ·
            <a href="politique-confidentialite.html">Politique de confidentialité</a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script src="assets/js/main.js"></script>

  <!-- ✅ SUPABASE AUTH + RESET + REDIRECT PANIER -->
  <script type="module">
  import { supabase } from "./assets/js/supabaseClient.js";

  const emailEl = document.getElementById("email");
  const passEl  = document.getElementById("password");

  const btnLogin  = document.getElementById("btnLogin");
  const btnSignup = document.getElementById("btnSignup");
  const btnLogout = document.getElementById("btnLogout");
  const btnSee    = document.getElementById("btnSeeBookings");

  const authBox   = document.getElementById("authBox");
  const loggedBox = document.getElementById("loggedBox");
  const perksBox  = document.getElementById("perksBox");
  const bookingsBox = document.getElementById("bookingsBox");

  const authMsg   = document.getElementById("authMsg");
  const userEmail = document.getElementById("userEmail");

  function setMsg(el, msg){ if(el) el.textContent = msg || ""; }

  function showLoggedOut(){
    if(authBox) authBox.style.display = "block";
    if(perksBox) perksBox.style.display = "block";
    if(loggedBox) loggedBox.style.display = "none";
    if(bookingsBox) bookingsBox.style.display = "none";
  }

  function showLoggedIn(user){
    if(authBox) authBox.style.display = "none";
    if(perksBox) perksBox.style.display = "none";
    if(loggedBox) loggedBox.style.display = "block";
    if(bookingsBox) bookingsBox.style.display = "block";
    if(userEmail) userEmail.textContent = user?.email || "";
  }

  // ---- init session ----
  const { data: { session }, error: sErr } = await supabase.auth.getSession();
  if(sErr) console.warn(sErr);

  if(session?.user) showLoggedIn(session.user);
  else showLoggedOut();

  // ---- login ----
  btnLogin?.addEventListener("click", async () => {
    setMsg(authMsg, "");
    const email = (emailEl?.value || "").trim();
    const password = passEl?.value || "";

    if(!email || !password){
      setMsg(authMsg, "Merci de renseigner un email et un mot de passe.");
      return;
    }

    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if(error){
      setMsg(authMsg, error.message);
      return;
    }

    showLoggedIn(data.user);
    setMsg(authMsg, "");
  });

  // ---- signup ----
  btnSignup?.addEventListener("click", async () => {
    setMsg(authMsg, "");
    const email = (emailEl?.value || "").trim();
    const password = passEl?.value || "";

    if(!email || !password){
      setMsg(authMsg, "Merci de renseigner un email et un mot de passe.");
      return;
    }

    const { error } = await supabase.auth.signUp({
      email,
      password,
      options: { emailRedirectTo: `${location.origin}/compte.html` }
    });

    if(error){
      setMsg(authMsg, error.message);
      return;
    }

    setMsg(authMsg, "Inscription envoyée. Vérifiez vos emails pour confirmer votre compte.");
  });

  // ---- logout ----
  btnLogout?.addEventListener("click", async () => {
    await supabase.auth.signOut();
    showLoggedOut();
  });

  // ---- keep UI in sync ----
  supabase.auth.onAuthStateChange((_evt, newSession) => {
    if(newSession?.user) showLoggedIn(newSession.user);
    else showLoggedOut();
  });
</script>


</body>
</html>