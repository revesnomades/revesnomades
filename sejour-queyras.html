<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Séjour dans le Queyras — Rêves Nomades</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=MuseoModerno:wght@400;500;600&family=Be+Vietnam+Pro:wght@200;300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body class="on-light">

<header class="nav" id="top">
  <div class="container nav-inner">
    <a class="brand" href="index.html" aria-label="Accueil Rêves Nomades">
      <img src="assets/img/logo-reves-nomades.png" alt="Logo Rêves Nomades" />
      <span>Rêves Nomades</span>
    </a>

    <nav class="nav-links nav-links-desktop">
      <a href="index.html#apropos" data-scroll>À propos</a>
      <a href="index.html#contact" data-scroll>Contact</a>
      <a class="icon-btn" href="compte.html" aria-label="Compte">
        <svg class="icon" viewBox="0 0 24 24" fill="none">
          <path d="M20 21c0-4.418-3.582-8-8-8s-8 3.582-8 8" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
          <path d="M12 13a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9Z" stroke="white" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
      </a>
    </nav>

    <button class="hamburger" type="button" aria-label="Ouvrir le menu" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>

    <div class="mobile-drawer" aria-hidden="true">
      <div class="mobile-menu">
        <a href="index.html#apropos" data-scroll>À propos</a>
        <a href="index.html#contact" data-scroll>Contact</a>
        <a href="compte.html">Compte</a>
      </div>
    </div>
  </div>
</header>

<section class="sejour-hero">
  <div class="sejour-hero-bg" style="background-image:url('assets/img/sejour-queyras.jpg');"></div>
</section>

<section class="band cream">
  <div class="container sejour-content">

    <h1 class="reveal">Séjour dans le Queyras</h1>

    <p class="sejour-meta reveal">
      5 jours · 4 nuits — <strong>920 €</strong> / personne
    </p>

    <p class="sejour-dates reveal">
      Dates : <span id="stayDates">Chargement…</span>
    </p>

    <div class="sejour-text reveal">
      <p>
        Une retraite d’altitude, dans un territoire préservé où le silence apaise
        et où la nature invite à se déposer.
      </p>
      <p>
        Pilates tous les jours, marches conscientes, temps de repos, massages,
        et cuisine saine préparée par une cheffe.
      </p>
      <p>
        Des ateliers cuisine pour apprendre à nourrir son corps avec simplicité,
        et repartir plus légère, plus ancrée, plus vivante.
      </p>
    </div>

    <p class="sejour-count reveal">
      Encore <strong id="missingCount">—</strong> réservations nécessaires pour valider ce séjour.
      <br>
      <span class="hint">Un email de confirmation vous sera envoyé dès que le séjour sera validé.</span>
    </p>

    <div class="booking-box reveal">
      <h3>Réserver</h3>

      <label class="kicker" for="roomSelect">Type de chambre</label>
      <select id="roomSelect" style="
        width:min(520px, 100%);
        margin-top:8px;
        padding:12px;
        border-radius:0;
        border:1px solid rgba(30,31,34,.18);
        background: rgba(255,255,255,.85);
        font-family:inherit;
        font-weight:300;
        color: var(--text);
      ">
        <option value="shared">Chambre partagée (incluse)</option>
        <option value="single">Chambre individuelle (+120€)</option>
      </select>

      <p class="small muted" style="margin-top:10px;">
        La quantité se sélectionne directement sur Stripe.
      </p>

      <div class="price-line">
        <span>Prix</span>
        <strong id="stayPriceLive">—</strong>
      </div>

      <div class="actions" style="margin-top:16px;">
        <a id="payBtn" class="btn on-light" target="_blank" rel="noopener">
          Réserver sur Stripe
        </a>
      </div>

      <p id="bookingMsg" class="small muted" style="margin-top:10px;"></p>
    </div>

    <script>
      const BASE_PRICE = 920;
      const SINGLE_EXTRA = 120;

      const STRIPE_LINKS = {
        shared: "https://buy.stripe.com/test_aFa8wJa13fIA2xn6J60ZW0i",
        single: "https://buy.stripe.com/test_fZu28la1353W9ZPaZm0ZW0h"
      };

      const sel = document.getElementById("roomSelect");
      const btn = document.getElementById("payBtn");
      const msg = document.getElementById("bookingMsg");
      const priceEl = document.getElementById("stayPriceLive");

      function formatEUR(n){
        return new Intl.NumberFormat("fr-FR", { style:"currency", currency:"EUR" }).format(n);
      }

      function syncBooking(){
        const room = sel.value;
        const link = STRIPE_LINKS[room];

        const price = room === "single" ? (BASE_PRICE + SINGLE_EXTRA) : BASE_PRICE;
        priceEl.textContent = formatEUR(price);

        if(!link){
          btn.removeAttribute("href");
          msg.textContent = "Lien Stripe manquant pour ce type de chambre.";
          return;
        }
        btn.href = link;
        msg.textContent = "";
      }

      sel.addEventListener("change", syncBooking);
      syncBooking();
    </script>

  </div>
</section>

<footer class="band cream">
  <div class="container footer">
    <div class="footer-row">
      <div class="footer-brand reveal" data-delay="0">
        <img src="assets/img/logo-reves-nomades.png" alt="Rêves Nomades">
        <div style="font-family:MuseoModerno; font-weight:500;">Rêves Nomades</div>
      </div>

      <div class="footer-social reveal" data-delay="1">
        <a class="icon-btn light" href="https://instagram.com/TON_COMPTE" target="_blank" rel="noopener" aria-label="Instagram">
          <svg class="icon" viewBox="0 0 24 24" fill="none">
            <path d="M7.5 2h9A5.5 5.5 0 0 1 22 7.5v9A5.5 5.5 0 0 1 16.5 22h-9A5.5 5.5 0 0 1 2 16.5v-9A5.5 5.5 0 0 1 7.5 2Z" stroke="currentColor" stroke-width="1.7"/>
            <path d="M12 16.2A4.2 4.2 0 1 0 12 7.8a4.2 4.2 0 0 0 0 8.4Z" stroke="currentColor" stroke-width="1.7"/>
            <path d="M17.6 6.4h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
          </svg>
        </a>

        <a class="icon-btn light" href="https://facebook.com/TA_PAGE" target="_blank" rel="noopener" aria-label="Facebook">
          <svg class="icon" viewBox="0 0 24 24" fill="none">
            <path d="M14 9h3V6h-3c-2.2 0-4 1.8-4 4v3H7v3h3v6h3v-6h3l1-3h-4v-3c0-.6.4-1 1-1Z" fill="currentColor"/>
          </svg>
        </a>

        <a href="index.html#apropos" style="font-size:12px; letter-spacing:.08em; text-transform:uppercase;">À propos</a>
      </div>
    </div>

    <div class="legal reveal" data-delay="2">
      <div style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;">
        <div>Copyright © 2026 Rêves Nomades</div>
        <div>
          <a href="mentions-legales.html">Mentions légales</a> ·
          <a href="politique-confidentialite.html">Politique de confidentialité</a>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="assets/js/main.js"></script>

<script type="module">
  import { hydrateStayPageDate } from "./assets/js/stayDates.js";
  hydrateStayPageDate("queyras", "stayDates");
</script>

<script type="module">
  import { supabase } from "./assets/js/supabaseClient.js";

  const EVENT_ID = "612c74e6-3c10-4525-b5c4-0004c0b3b75c";
  const MIN_BOOKINGS = 10;

  async function loadMissing(){
    const el = document.getElementById("missingCount");
    if(!el) return;

    const { data, error } = await supabase
      .from("bookings")
      .select("places")
      .eq("event_id", EVENT_ID)
      .eq("paid", true);

    if(error){
      el.textContent = "—";
      return;
    }

    const total = (data || []).reduce((sum, b) => sum + (Number(b.places) || 0), 0);
    el.textContent = String(Math.max(0, MIN_BOOKINGS - total));
  }

  loadMissing();
</script>

</body>
</html>
